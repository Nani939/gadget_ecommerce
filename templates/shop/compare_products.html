{% extends "base.html" %}
{% load static %}

{% block title %}Compare Products - Gadget Shop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/amazon-style.css' %}">
<style>
.compare-header {
    background: linear-gradient(135deg, #9b59b6, #8e44ad);
    color: white;
    padding: 40px 20px;
    text-align: center;
    border-radius: 8px;
    margin-bottom: 30px;
}

.compare-table {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.compare-table table {
    width: 100%;
    border-collapse: collapse;
}

.compare-table th {
    background: #34495e;
    color: white;
    padding: 15px 10px;
    text-align: center;
    font-weight: 600;
}

.compare-table td {
    padding: 15px 10px;
    text-align: center;
    border-bottom: 1px solid #ecf0f1;
    vertical-align: middle;
}

.compare-table tr:nth-child(even) {
    background: #f8f9fa;
}

.product-image {
    width: 120px;
    height: 120px;
    object-fit: contain;
    border-radius: 6px;
}

.feature-row {
    background: #e8f4fd !important;
}

.price-cell {
    font-size: 20px;
    font-weight: bold;
    color: #e74c3c;
}

.best-value {
    background: #d4edda !important;
    position: relative;
}

.best-value::before {
    content: 'üèÜ BEST VALUE';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    background: #28a745;
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: bold;
}

.remove-btn {
    background: #e74c3c;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
}

.ai-recommendation {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
    text-align: center;
}
</style>
{% endblock %}

{% block content %}
<div class="amazon-container">
    <!-- Compare Header -->
    <div class="compare-header">
        <h1 style="font-size: 36px; margin-bottom: 10px;">üìä Product Comparison</h1>
        <p style="font-size: 18px; margin: 0;">Compare {{ compare_count }} product{{ compare_count|pluralize }} side by side</p>
    </div>

    {% if products %}
        <!-- Comparison Table -->
        <div class="compare-table">
            <table>
                <thead>
                    <tr>
                        <th style="width: 150px;">Features</th>
                        {% for product in products %}
                            <th style="width: 200px;">
                                <button onclick="removeFromCompare({{ product.id }})" class="remove-btn">‚úï</button>
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    <!-- Product Images -->
                    <tr>
                        <td style="font-weight: bold; background: #ecf0f1;">Product</td>
                        {% for product in products %}
                            <td>
                                <img src="{% if product.image %}{{ product.image.url }}{% else %}https://via.placeholder.com/120x120?text=No+Image{% endif %}" 
                                     alt="{{ product.name }}" class="product-image"
                                     onerror="this.src='https://via.placeholder.com/120x120?text=No+Image'">
                                <div style="font-weight: bold; margin-top: 10px;">{{ product.name }}</div>
                            </td>
                        {% endfor %}
                    </tr>
                    
                    <!-- Price Comparison -->
                    <tr>
                        <td style="font-weight: bold; background: #ecf0f1;">Price</td>
                        {% for product in products %}
                            <td class="price-cell {% if forloop.first %}best-value{% endif %}">
                                ‚Çπ{{ product.price|floatformat:2 }}
                            </td>
                        {% endfor %}
                    </tr>
                    
                    <!-- Rating -->
                    <tr>
                        <td style="font-weight: bold; background: #ecf0f1;">Rating</td>
                        {% for product in products %}
                            <td>
                                <div class="amazon-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
                                <div style="font-size: 12px; color: #666;">({{ product.id|add:47 }} reviews)</div>
                            </td>
                        {% endfor %}
                    </tr>
                    
                    <!-- Stock Status -->
                    <tr>
                        <td style="font-weight: bold; background: #ecf0f1;">Availability</td>
                        {% for product in products %}
                            <td>
                                {% if product.stock > 0 %}
                                    <span style="color: #27ae60; font-weight: bold;">‚úÖ In Stock</span>
                                    <div style="font-size: 12px;">({{ product.stock }} available)</div>
                                {% else %}
                                    <span style="color: #e74c3c; font-weight: bold;">‚ùå Out of Stock</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                    
                    <!-- Features -->
                    <tr class="feature-row">
                        <td style="font-weight: bold;">Brand</td>
                        {% for product in products %}
                            <td>Gadget Shop</td>
                        {% endfor %}
                    </tr>
                    
                    <tr class="feature-row">
                        <td style="font-weight: bold;">Model</td>
                        {% for product in products %}
                            <td>GS-{{ product.id|stringformat:"04d" }}</td>
                        {% endfor %}
                    </tr>
                    
                    <tr class="feature-row">
                        <td style="font-weight: bold;">Weight</td>
                        {% for product in products %}
                            <td>{{ product.id|add:100 }}g</td>
                        {% endfor %}
                    </tr>
                    
                    <tr class="feature-row">
                        <td style="font-weight: bold;">Warranty</td>
                        {% for product in products %}
                            <td>1 Year</td>
                        {% endfor %}
                    </tr>
                    
                    <!-- Actions -->
                    <tr>
                        <td style="font-weight: bold; background: #ecf0f1;">Actions</td>
                        {% for product in products %}
                            <td>
                                {% if product.stock > 0 %}
                                    <form method="post" action="{% url 'shop:add_to_cart' product.id %}" style="margin-bottom: 10px;">
                                        {% csrf_token %}
                                        <button type="submit" class="amazon-btn amazon-btn-primary" style="width: 100%; padding: 8px;">
                                            üõí Add to Cart
                                        </button>
                                    </form>
                                    
                                    <form method="post" action="{% url 'shop:add_to_wishlist' product.id %}">
                                        {% csrf_token %}
                                        <button type="submit" class="amazon-btn amazon-btn-secondary" style="width: 100%; padding: 8px;">
                                            ‚ù§Ô∏è Add to Wishlist
                                        </button>
                                    </form>
                                {% else %}
                                    <button class="amazon-btn" style="width: 100%; background: #ccc; cursor: not-allowed;" disabled>
                                        Out of Stock
                                    </button>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- AI Recommendation -->
        <div class="ai-recommendation">
            <h3 style="margin-bottom: 15px;">ü§ñ AI Recommendation</h3>
            <p style="font-size: 16px; margin-bottom: 15px;">
                Based on your comparison, we recommend <strong>{{ products.0.name }}</strong> 
                for the best value and features combination.
            </p>
            <a href="{{ products.0.get_absolute_url }}" class="amazon-btn amazon-btn-primary" style="background: white; color: #667eea; padding: 12px 24px;">
                View Recommended Product
            </a>
        </div>
        
    {% else %}
        <!-- Empty Compare -->
        <div class="amazon-empty-cart">
            <div style="font-size: 80px; margin-bottom: 20px;">üìä</div>
            <h2>No products to compare</h2>
            <p>Add products to comparison by clicking the "Compare" button on product pages</p>
            <a href="{% url 'products:product_list' %}" class="amazon-btn amazon-btn-primary" style="padding: 15px 30px; font-size: 16px;">
                üõçÔ∏è Browse Products
            </a>
        </div>
    {% endif %}
</div>

<script>
function removeFromCompare(productId) {
    if (confirm('Remove this product from comparison?')) {
        // Implementation for removing from comparison
        window.location.reload();
    }
}
</script>
{% endblock %}