{% extends "base.html" %}
{% load static %}

{% block title %}All Products - Gadget Shop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/amazon-style.css' %}">
{% endblock %}

{% block content %}
<div class="amazon-container">
  <!-- Breadcrumb -->
  <div class="amazon-breadcrumb">
    <a href="{% url 'shop:home' %}">Home</a> â€º 
    <span>All Products</span>
  </div>

  <!-- Page Header -->
  <div style="margin-bottom: 20px;">
    <h1 style="font-size: 28px; font-weight: 400; color: var(--amazon-text); margin-bottom: 8px;">
      All Products
    </h1>
    <div style="font-size: 14px; color: #565959;">
      {{ products|length }} result{{ products|length|pluralize }} for "all products"
    </div>
  </div>

  <!-- Filters and Sort -->
  <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px; padding: 16px; background: white; border: 1px solid var(--amazon-border); border-radius: 8px;">
    <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
      <span style="font-weight: 700; color: var(--amazon-text);">Filter by:</span>
      <select class="amazon-form-input" style="width: auto; min-width: 120px;">
        <option>All Categories</option>
        <option>Electronics</option>
        <option>Accessories</option>
        <option>Mobile Phones</option>
      </select>
      <select class="amazon-form-input" style="width: auto; min-width: 120px;">
        <option>All Brands</option>
        <option>Apple</option>
        <option>Samsung</option>
        <option>OnePlus</option>
      </select>
    </div>
    <div style="display: flex; gap: 8px; align-items: center;">
      <span style="font-size: 14px; color: #565959;">Sort by:</span>
      <select class="amazon-form-input" style="width: auto; min-width: 140px;">
        <option>Featured</option>
        <option>Price: Low to High</option>
        <option>Price: High to Low</option>
        <option>Customer Reviews</option>
        <option>Newest Arrivals</option>
      </select>
    </div>
  </div>

  <!-- Products Grid -->
  {% if products %}
    <div class="amazon-product-grid">
      {% for product in products %}
        <div class="amazon-product-card">
          <!-- Product Image -->
          <div class="amazon-product-image">
            <a href="{{ product.get_absolute_url }}">
              <img src="{% if product.image %}{{ product.image.url }}{% else %}https://via.placeholder.com/200x200?text=No+Image{% endif %}" 
                   alt="{{ product.name }}"
                   onerror="this.src='https://via.placeholder.com/200x200?text=No+Image'">
            </a>
          </div>

          <!-- Product Info -->
          <div>
            <a href="{{ product.get_absolute_url }}" class="amazon-product-title">
              {{ product.name }}
            </a>

            <!-- Rating (Mock data for demo) -->
            <div class="amazon-product-rating">
              <div class="amazon-stars">
                â˜…â˜…â˜…â˜…â˜†
              </div>
              <a href="#" class="amazon-rating-count">({{ product.id|add:47 }})</a>
            </div>

            <!-- Price -->
            <div class="amazon-product-price">
              <div class="amazon-price">
                <span class="amazon-price-symbol">â‚¹</span>{{ product.price|floatformat:2 }}
              </div>
              {% if product.id|divisibleby:3 %}
                <div style="font-size: 12px; color: #565959; text-decoration: line-through;">
                  â‚¹{{ product.price|add:500|floatformat:2 }}
                </div>
              {% endif %}
            </div>

            <!-- Prime Badge (Mock) -->
            {% if product.id|divisibleby:2 %}
              <div style="margin-bottom: 8px;">
                <span style="background: var(--amazon-link); color: white; font-size: 11px; padding: 2px 6px; border-radius: 2px; font-weight: 700;">
                  prime
                </span>
                <span style="font-size: 12px; color: #565959; margin-left: 4px;">
                  FREE delivery
                </span>
              </div>
            {% endif %}

            <!-- Stock Status -->
            <div style="font-size: 14px; color: var(--amazon-success); margin-bottom: 12px;">
              {% if product.available %}
                In Stock
              {% else %}
                Currently unavailable
              {% endif %}
            </div>

            <!-- Action Buttons -->
            <div class="amazon-product-actions">
              <form method="post" action="{% url 'shop:add_to_cart' product.id %}" style="margin: 0;">
                {% csrf_token %}
                <input type="hidden" name="quantity" value="1">
                <button type="submit" class="amazon-btn amazon-btn-primary" style="width: 100%;">
                  Add to Cart
                </button>
              </form>
              
              <form method="post" action="{% url 'shop:buy_now' product.id %}" style="margin: 0;">
                {% csrf_token %}
                <button type="submit" class="amazon-btn amazon-btn-secondary" style="width: 100%;">
                  Buy Now
                </button>
              </form>
            </div>

            <!-- Additional Info -->
            <div style="margin-top: 8px; font-size: 12px; color: #565959;">
              <div>Ships from Gadget Shop</div>
              {% if product.id|divisibleby:4 %}
                <div>Climate Pledge Friendly</div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Pagination (if needed) -->
    <div style="margin-top: 40px; text-align: center; padding: 20px;">
      <div style="display: inline-flex; gap: 8px; align-items: center;">
        <button class="amazon-btn amazon-btn-secondary" disabled>Previous</button>
        <span style="padding: 8px 16px; background: var(--amazon-orange); color: var(--amazon-blue); border-radius: 4px; font-weight: 700;">1</span>
        <button class="amazon-btn amazon-btn-secondary">2</button>
        <button class="amazon-btn amazon-btn-secondary">3</button>
        <span style="padding: 8px;">...</span>
        <button class="amazon-btn amazon-btn-secondary">Next</button>
      </div>
    </div>

  {% else %}
    <!-- No Products -->
    <div class="amazon-empty-cart">
      <div class="amazon-empty-cart-icon">ðŸ“¦</div>
      <h2>No products found</h2>
      <p>We couldn't find any products matching your criteria.</p>
      <a href="{% url 'shop:home' %}" class="amazon-btn amazon-btn-primary">
        Go to Homepage
      </a>
    </div>
  {% endif %}

  <!-- Recently Viewed -->
  <div style="margin-top: 60px; padding-top: 24px; border-top: 1px solid #e7e7e7;">
    <h2 style="font-size: 21px; font-weight: 400; margin-bottom: 16px;">
      Your recently viewed items
    </h2>
    <div style="font-size: 14px; color: #565959;">
      <a href="#" class="amazon-action-link">View or edit your browsing history</a>
    </div>
  </div>
</div>

<script>
// Add loading states to buttons
document.addEventListener('DOMContentLoaded', function() {
  const buttons = document.querySelectorAll('.amazon-btn');
  
  buttons.forEach(button => {
    if (button.type === 'submit') {
      button.addEventListener('click', function() {
        const originalText = this.textContent;
        this.innerHTML = '<span class="amazon-loading"></span> ' + originalText;
        this.disabled = true;
        
        // Re-enable after form submission (in case of errors)
        setTimeout(() => {
          this.innerHTML = originalText;
          this.disabled = false;
        }, 3000);
      });
    }
  });
});
</script>
{% endblock %}