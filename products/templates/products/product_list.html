{% extends "base.html" %}
{% load static %}

{% block title %}All Products - Gadget Shop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/amazon-style.css' %}">
{% endblock %}

{% block content %}
<div class="amazon-container">
  <!-- Breadcrumb -->
  <div class="amazon-breadcrumb">
    <a href="{% url 'shop:home' %}">Home</a> › 
    <span>All Products</span>
  </div>

  <!-- Page Header -->
  <div class="product-list-header">
    <h1 class="product-list-title">All Products</h1>
    <div class="product-list-count">{{ products|length }} result{{ products|length|pluralize }} for "all products"</div>
  </div>

  <!-- Filters and Sort -->
  <div class="product-list-filters">
    <div class="product-list-filter-group">
      <span class="product-list-filter-label">Filter by:</span>
      <select class="amazon-form-input product-list-select" title="Filter by Category">
        <option>All Categories</option>
        <option>Electronics</option>
        <option>Accessories</option>
        <option>Mobile Phones</option>
      </select>
      <select class="amazon-form-input product-list-select" title="Filter by Brand">
        <option>All Brands</option>
        <option>Apple</option>
        <option>Samsung</option>
        <option>OnePlus</option>
      </select>
    </div>
    <div class="product-list-sort-group">
      <span class="product-list-sort-label">Sort by:</span>
      <select class="amazon-form-input product-list-sort-select" title="Sort Products">
        <option>Featured</option>
        <option>Price: Low to High</option>
        <option>Price: High to Low</option>
        <option>Customer Reviews</option>
        <option>Newest Arrivals</option>
      </select>
    </div>
  </div>

  <!-- Products Grid -->
  {% if products %}
    <div class="amazon-product-grid">
      {% for product in products %}
        <div class="amazon-product-card">
          <!-- Product Image -->
          <div class="amazon-product-image">
            <a href="{{ product.get_absolute_url }}">
              <img src="{% if product.image %}{{ product.image.url }}{% else %}https://via.placeholder.com/200x200?text=No+Image{% endif %}" 
                   alt="{{ product.name }}"
                   onerror="this.src='https://via.placeholder.com/200x200?text=No+Image'">
            </a>
          </div>

          <!-- Product Info -->
          <div>
            <a href="{{ product.get_absolute_url }}" class="amazon-product-title">
              {{ product.name }}
            </a>

            <!-- Rating (Mock data for demo) -->
            <div class="amazon-product-rating">
              <div class="amazon-stars">★★★★☆</div>
              <a href="#" class="amazon-rating-count">({{ product.id|add:47 }})</a>
            </div>

            <!-- Price -->
            <div class="amazon-product-price">
              <div class="amazon-price">
                <span class="amazon-price-symbol">₹</span>{{ product.price|floatformat:2 }}
              </div>
              {% if product.id|divisibleby:3 %}
                <div class="product-list-old-price">
                  ₹{{ product.price|add:500|floatformat:2 }}
                </div>
              {% endif %}
            </div>

            <!-- Prime Badge (Mock) -->
            {% if product.id|divisibleby:2 %}
              <div class="product-list-prime-row">
                <span class="product-list-prime-badge">prime</span>
                <span class="product-list-prime-delivery">FREE delivery</span>
              </div>
            {% endif %}

            <!-- Stock Status -->
            <div class="product-list-stock-status">
              {% if product.available %}
                In Stock
              {% else %}
                Currently unavailable
              {% endif %}
            </div>

            <!-- Action Buttons -->
            <div class="amazon-product-actions">
              {% if product.available and product.stock > 0 %}
              <form method="post" action="{% url 'shop:add_to_cart' product.id %}" class="product-list-action-form">
                {% csrf_token %}
                <input type="hidden" name="quantity" value="1">
                <button type="submit" class="amazon-btn amazon-btn-primary product-list-btn-fullwidth">
                  <i class="fas fa-cart-plus"></i> Add to Cart
                </button>
              </form>
              
              <form method="post" action="{% url 'shop:buy_now' product.id %}" class="product-list-action-form">
                {% csrf_token %}
                <input type="hidden" name="quantity" value="1">
                <button type="submit" class="amazon-btn amazon-btn-secondary product-list-btn-fullwidth">
                  <i class="fas fa-bolt"></i> Buy Now
                </button>
              </form>
              {% else %}
              <button class="amazon-btn product-list-btn-disabled" type="button" disabled>
                <i class="fas fa-times"></i> {% if product.stock <= 0 %}Out of Stock{% else %}Unavailable{% endif %}
              </button>
              {% endif %}
              <!-- Wishlist Button -->
              <form method="post" action="{% url 'shop:add_to_wishlist' product.id %}" class="product-list-wishlist-form">
                {% csrf_token %}
                <button type="submit" title="Add to Wishlist" class="product-list-wishlist-btn">
                  <i class="fas fa-heart"></i>
                </button>
              </form>
            </div>

            <!-- Additional Info -->
            <div class="product-list-additional-info">
              <div>Ships from Gadget Shop</div>
              {% if product.id|divisibleby:4 %}
                <div>Climate Pledge Friendly</div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Pagination (if needed) -->
    <div class="product-list-pagination">
        <div class="product-list-pagination-group">
          <button class="amazon-btn amazon-btn-secondary" disabled>Previous</button>
          <span class="product-list-pagination-current">1</span>
          <button class="amazon-btn amazon-btn-secondary">2</button>
          <button class="amazon-btn amazon-btn-secondary">3</button>
          <span class="product-list-pagination-ellipsis">...</span>
          <button class="amazon-btn amazon-btn-secondary">Next</button>
        </div>
      </div>

  {% else %}
    <!-- No Products -->
    <div class="amazon-empty-cart">
      <div class="amazon-empty-cart-icon">
        <i class="fas fa-box-open" style="font-size: 80px; opacity: 0.5;"></i>
      </div>
      <h2>No products found</h2>
      <p>We couldn't find any products matching your criteria.</p>
      <a href="{% url 'shop:home' %}" class="amazon-btn amazon-btn-primary">
        <i class="fas fa-home"></i> Go to Homepage
      </a>
    </div>
  {% endif %}

  <!-- Recently Viewed -->
  <div class="product-list-recently-viewed">
    <h2 class="product-list-recently-title">Your recently viewed items</h2>
    <div class="product-list-recently-link-row">
      <a href="#" class="amazon-action-link product-list-recently-link">
        <i class="fas fa-history"></i> View or edit your browsing history
      </a>
    </div>
  </div>
</div>
{% endblock %}
