{% extends "base.html" %}
{% load static %}

{% block title %}My Wishlist - Gadget Shop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/amazon-style.css' %}">
{% endblock %}

{% block content %}
<div class="amazon-container">
    <!-- Wishlist Header -->
    <div class="wishlist-header">
        <h1 class="wishlist-title">‚ù§Ô∏è My Wishlist</h1>
        <p class="wishlist-count">{{ wishlist_count }} item{{ wishlist_count|pluralize }} saved for later</p>
    </div>

    {% if products %}
        <!-- Wishlist Items -->
        {% for product in products %}
            <div class="wishlist-item">
                <div class="heart-icon">‚ù§Ô∏è</div>

                <!-- Product Image -->
                <img src="{% if product.image %}{{ product.image.url }}{% else %}https://via.placeholder.com/150x150?text=No+Image{% endif %}" 
                     alt="{{ product.name }}" class="wishlist-image"
                     onerror="this.src='https://via.placeholder.com/150x150?text=No+Image'">

                <!-- Product Details -->
                <div class="wishlist-details">
                    <h3 class="wishlist-product-title">
                        <a href="{{ product.get_absolute_url }}" class="wishlist-product-link">
                            {{ product.name }}
                        </a>
                    </h3>

                    <div class="wishlist-rating-row">
                        <div class="amazon-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
                        <span class="wishlist-review-count">({{ product.id|add:47 }} reviews)</span>
                    </div>

                    <div class="wishlist-product-price">
                        ‚Çπ{{ product.price|floatformat:2 }}
                    </div>

                    <div class="wishlist-stock-status">
                        {% if product.stock > 0 %}
                            ‚úÖ In Stock ({{ product.stock }} available)
                        {% else %}
                            ‚ùå Out of Stock
                        {% endif %}
                    </div>

                    <div class="wishlist-added-date">
                        Added to wishlist on {{ product.created|date:"M j, Y" }}
                    </div>

                    <!-- Wishlist Actions -->
                    <div class="wishlist-actions">
                        {% if product.stock > 0 %}
                            <form method="post" action="{% url 'shop:add_to_cart' product.id %}">
                                {% csrf_token %}
                                <button type="submit" class="amazon-btn amazon-btn-primary wishlist-btn-fullwidth" title="Add to Cart">
                                    üõí Add to Cart
                                </button>
                            </form>
                            <form method="post" action="{% url 'shop:buy_now' product.id %}">
                                {% csrf_token %}
                                <button type="submit" class="amazon-btn amazon-btn-secondary wishlist-btn-fullwidth wishlist-btn-buynow" title="Buy Now">
                                    ‚ö° Buy Now
                                </button>
                            </form>
                        {% else %}
                            <button class="amazon-btn wishlist-btn-fullwidth wishlist-btn-disabled" disabled>
                                Out of Stock
                            </button>
                        {% endif %}

                        <a href="{% url 'shop:add_to_compare' product.id %}" class="amazon-btn amazon-btn-secondary wishlist-btn-fullwidth" title="Compare Product">
                            üîç Compare
                        </a>
                        <button type="button" onclick="removeFromWishlist({{ product.id }})" class="amazon-btn wishlist-btn-fullwidth wishlist-btn-remove" title="Remove from Wishlist">
                            ‚ùå Remove
                        </button>
                        <button type="button" onclick="shareProduct({{ product.id }})" class="amazon-btn amazon-btn-secondary wishlist-btn-fullwidth" title="Share Product">
                            üì§ Share
                        </button>
                    </div>
                </div>
            </div>
        {% endfor %}

        <!-- Wishlist Bulk Actions -->
        <div class="wishlist-actions-row">
            <button type="button" onclick="addAllToCart()" class="amazon-btn amazon-btn-primary wishlist-btn-large" title="Add All to Cart">
                üõí Add All to Cart
            </button>
            <button type="button" onclick="clearWishlist()" class="amazon-btn wishlist-btn-large wishlist-btn-removeall" title="Clear Wishlist">
                üóëÔ∏è Clear Wishlist
            </button>
        </div>
    {% else %}
        <!-- Empty Wishlist -->
        <div class="amazon-empty-cart">
            <div style="font-size: 80px; margin-bottom: 20px;">üíî</div>
            <h2>Your wishlist is empty</h2>
            <p>Save items you love for later by clicking the heart icon ‚ù§Ô∏è</p>
            <a href="{% url 'products:product_list' %}" class="amazon-btn amazon-btn-primary wishlist-btn-large" title="Start Shopping">
                üõçÔ∏è Start Shopping
            </a>
        </div>
    {% endif %}
</div>

<script>
function removeFromWishlist(productId) {
    if (confirm('Remove this item from your wishlist?')) {
        // Implementation for removing from wishlist (AJAX or redirect)
        window.location.reload();
    }
}

function shareProduct(productId) {
    const url = window.location.origin + '/products/' + productId + '/';
    if (navigator.share) {
        navigator.share({
            title: 'Check out this product!',
            url: url
        });
    } else {
        navigator.clipboard.writeText(url).then(() => {
            alert('Product link copied to clipboard!');
        });
    }
}

function addAllToCart() {
    if (confirm('Add all wishlist items to cart?')) {
        alert('All available items added to cart!');
    }
}

function clearWishlist() {
    if (confirm('Are you sure you want to clear your entire wishlist?')) {
        alert('Wishlist cleared!');
        window.location.reload();
    }
}
</script>
{% endblock %}
