{% extends "base.html" %}
{% load static %}

{% block title %}Shopping Cart - Gadget Shop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/amazon-style.css' %}">
{% endblock %}

{% block content %}
<div class="amazon-container">
  <!-- Breadcrumb -->
  <div class="amazon-breadcrumb">
    <a href="{% url 'shop:home' %}">Home</a> › 
    <span>Shopping Cart</span>
  </div>

  {% if cart_items %}
    <div class="amazon-cart-container">
      <!-- Main Cart Content -->
      <div class="amazon-cart-main">
        <div class="amazon-cart-header">
          <h1 class="amazon-cart-title">Shopping Cart</h1>
          <p class="amazon-cart-continue">
            <a href="{% url 'products:product_list' %}" class="amazon-action-link">Continue shopping</a>
          </p>
        </div>

        <div class="amazon-cart-items">
          {% for item in cart_items %}
            <div class="amazon-cart-item">
              <!-- Product Image -->
              <div class="amazon-item-image">
                <img src="{% if item.product.image %}{{ item.product.image.url }}{% else %}{% static 'images/no-image.jpg' %}{% endif %}" 
                     alt="{{ item.product.name }}"
                     onerror="this.src='https://via.placeholder.com/160x160?text=No+Image'">
              </div>

              <!-- Product Details -->
              <div class="amazon-item-details">
                <a href="{{ item.product.get_absolute_url }}" class="amazon-item-title">
                  {{ item.product.name }}
                </a>
                
                <div class="amazon-item-info amazon-in-stock">In Stock</div>
                <div class="amazon-item-info amazon-sku">SKU: #{{ item.product.id|stringformat:"04d" }}</div>

                <div class="amazon-item-actions">
                  <!-- Quantity Selector -->
                  <div class="amazon-quantity-selector">
                    <form method="post" action="{% url 'shop:update_quantity' item.product.id %}" class="amazon-inline-form">
                      {% csrf_token %}
                      <select name="quantity" class="amazon-quantity-dropdown" title="Select quantity" onchange="this.form.submit()">
                        {% for i in "123456789" %}
                          <option value="{{ forloop.counter }}" {% if item.quantity == forloop.counter %}selected{% endif %}>
                            Qty: {{ forloop.counter }}
                          </option>
                        {% endfor %}
                        <option value="10" {% if item.quantity == 10 %}selected{% endif %}>Qty: 10+</option>
                      </select>
                    </form>
                  </div>

                  <!-- Action Links -->
                  <span class="amazon-divider">|</span>
                  
                  <a href="{% url 'shop:remove_from_cart' item.product.id %}" 
                     class="amazon-action-link"
                     onclick="return confirm('Are you sure you want to remove this item from your cart?')">
                    <i class="fas fa-trash"></i> Delete
                  </a>

                  <span class="amazon-divider">|</span>
                  
                  <a href="#" class="amazon-action-link">
                    <i class="fas fa-bookmark"></i> Save for later
                  </a>

                  <span class="amazon-divider">|</span>
                  
                  <a href="#" class="amazon-action-link">
                    <i class="fas fa-balance-scale"></i> Compare with similar items
                  </a>
                </div>
              </div>

              <!-- Price -->
              <div class="amazon-item-price">
                <div class="amazon-price">
                  <span class="amazon-price-symbol">₹</span>{{ item.total|floatformat:2 }}
                </div>
                <div class="amazon-item-each">(₹{{ item.product.price }} each)</div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- Cart Summary Sidebar -->
      <div class="amazon-cart-sidebar">
        <div class="amazon-subtotal">
          Subtotal ({{ total_qty }} item{{ total_qty|pluralize }}): 
          <span class="amazon-subtotal-price">₹{{ total_price|floatformat:2 }}</span>
        </div>

        <div class="amazon-shipping-info">
          <i class="bi bi-check-circle-fill amazon-shipping-icon"></i>
          FREE delivery on orders over ₹499
        </div>

        <a href="{% url 'shop:checkout' %}" class="amazon-checkout-btn">
          <i class="fas fa-credit-card"></i> Proceed to Buy
        </a>

        <div class="amazon-gift-option">
          <label class="amazon-gift-label">
            <input type="checkbox" class="amazon-gift-checkbox">
            This order contains a gift
          </label>
        </div>

        <!-- Recommended Items -->
        <div class="amazon-frequently-bought">
          <h3 class="amazon-frequently-title">Frequently bought together</h3>
          <div class="amazon-frequently-desc">Customers who bought items in your cart also bought these products.</div>
        </div>
      </div>
    </div>

    <!-- Recently Viewed -->
    <div class="amazon-recently-viewed">
      <h2 class="amazon-recently-title">Your recently viewed items</h2>
      <div class="amazon-recently-desc">
        <a href="{% url 'products:product_list' %}" class="amazon-action-link">
          View or edit your browsing history
        </a>
      </div>
    </div>

  {% else %}
    <!-- Empty Cart -->
    <div class="amazon-empty-cart">
      <div class="amazon-empty-cart-icon">
        <i class="fas fa-shopping-cart" style="font-size: 80px; opacity: 0.5;"></i>
      </div>
      <h2>Your Gadget Shop Cart is empty</h2>
      <p>Check your saved for later items below or <a href="{% url 'products:product_list' %}" class="amazon-action-link">continue shopping</a>.</p>
      
      <div class="amazon-empty-cart-actions">
        <a href="{% url 'users:login' %}" class="amazon-btn amazon-btn-primary">
          <i class="fas fa-sign-in-alt"></i> Sign in to your account
        </a>
        <a href="{% url 'users:signup' %}" class="amazon-btn amazon-btn-secondary">
          <i class="fas fa-user-plus"></i> Sign up now
        </a>
      </div>

      <!-- Recommended Products for Empty Cart -->
      <div class="amazon-empty-cart-deals">
        <h3 class="amazon-empty-cart-deals-title">Shop today's deals</h3>
        <div class="amazon-product-grid amazon-empty-cart-grid">
          <!-- This would be populated with featured products -->
          <div class="amazon-empty-cart-browse">
            <a href="{% url 'products:product_list' %}" class="amazon-action-link">
              <i class="fas fa-arrow-right"></i> Browse our product catalog
            </a>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div>

<script>
// Enhanced cart interactions
document.addEventListener('DOMContentLoaded', function() {
  const quantitySelects = document.querySelectorAll('.amazon-quantity-dropdown');
  
  quantitySelects.forEach(select => {
    select.addEventListener('change', function() {
      // Add loading state
      const originalHTML = this.innerHTML;
      this.innerHTML = '<option><i class="fas fa-spinner fa-spin"></i> Updating...</option>';
      this.disabled = true;
      
      // Submit form
      this.form.submit();
    });
  });
  
  // Add to cart animation
  document.querySelectorAll('form[action*="add_to_cart"]').forEach(form => {
    form.addEventListener('submit', function(e) {
      const button = this.querySelector('button[type="submit"]');
      if (button) {
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
        button.disabled = true;
      }
    });
  });
  
  // Wishlist button animation
  document.querySelectorAll('.product-list-wishlist-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      this.innerHTML = '<i class="fas fa-heart" style="color: #ff6b6b;"></i>';
      this.style.backgroundColor = '#ff6b6b';
      this.style.color = 'white';
      this.style.borderColor = '#ff6b6b';
      
      setTimeout(() => {
        this.closest('form').submit();
      }, 300);
    });
  });
});
</script>
{% endblock %}