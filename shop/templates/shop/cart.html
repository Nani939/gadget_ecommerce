{% extends "base.html" %}
{% load static %}

{% block title %}Shopping Cart - Gadget Shop{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/amazon-style.css' %}">
{% endblock %}

{% block content %}
<div class="amazon-container">
  <!-- Breadcrumb -->
  <div class="amazon-breadcrumb">
    <a href="{% url 'shop:home' %}">Home</a> â€º 
    <span>Shopping Cart</span>
  </div>

  {% if cart_items %}
    <div class="amazon-cart-container">
      <!-- Main Cart Content -->
      <div class="amazon-cart-main">
        <div class="amazon-cart-header">
          <h1 class="amazon-cart-title">Shopping Cart</h1>
          <p style="margin: 8px 0 0 0; color: #565959;">
            <a href="{% url 'products:product_list' %}" class="amazon-action-link">Continue shopping</a>
          </p>
        </div>

        <div class="amazon-cart-items">
          {% for item in cart_items %}
            <div class="amazon-cart-item">
              <!-- Product Image -->
              <div class="amazon-item-image">
                <img src="{% if item.product.image %}{{ item.product.image.url }}{% else %}{% static 'images/no-image.jpg' %}{% endif %}" 
                     alt="{{ item.product.name }}"
                     onerror="this.src='https://via.placeholder.com/160x160?text=No+Image'">
              </div>

              <!-- Product Details -->
              <div class="amazon-item-details">
                <a href="{{ item.product.get_absolute_url }}" class="amazon-item-title">
                  {{ item.product.name }}
                </a>
                
                <div class="amazon-item-info">
                  <span style="color: var(--amazon-success); font-weight: 500;">In Stock</span>
                </div>

                <div class="amazon-item-info">
                  <span style="font-size: 12px; color: #565959;">
                    SKU: #{{ item.product.id|stringformat:"04d" }}
                  </span>
                </div>

                <div class="amazon-item-actions">
                  <!-- Quantity Selector -->
                  <div class="amazon-quantity-selector">
                    <form method="post" action="{% url 'shop:update_quantity' item.product.id %}" style="display: inline;">
                      {% csrf_token %}
                      <select name="quantity" class="amazon-quantity-dropdown" onchange="this.form.submit()">
                        {% for i in "123456789" %}
                          <option value="{{ forloop.counter }}" {% if item.quantity == forloop.counter %}selected{% endif %}>
                            Qty: {{ forloop.counter }}
                          </option>
                        {% endfor %}
                        <option value="10" {% if item.quantity == 10 %}selected{% endif %}>Qty: 10+</option>
                      </select>
                    </form>
                  </div>

                  <!-- Action Links -->
                  <span style="color: #e7e7e7;">|</span>
                  
                  <a href="{% url 'shop:remove_from_cart' item.product.id %}" 
                     class="amazon-action-link"
                     onclick="return confirm('Are you sure you want to remove this item from your cart?')">
                    Delete
                  </a>

                  <span style="color: #e7e7e7;">|</span>
                  
                  <a href="#" class="amazon-action-link">Save for later</a>

                  <span style="color: #e7e7e7;">|</span>
                  
                  <a href="#" class="amazon-action-link">Compare with similar items</a>
                </div>
              </div>

              <!-- Price -->
              <div class="amazon-item-price">
                <div class="amazon-price">
                  <span class="amazon-price-symbol">â‚¹</span>{{ item.total|floatformat:2 }}
                </div>
                <div style="font-size: 12px; color: #565959; margin-top: 4px;">
                  (â‚¹{{ item.product.price }} each)
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- Cart Summary Sidebar -->
      <div class="amazon-cart-sidebar">
        <div class="amazon-subtotal">
          Subtotal ({{ total_qty }} item{{ total_qty|pluralize }}): 
          <span class="amazon-subtotal-price">â‚¹{{ total_price|floatformat:2 }}</span>
        </div>

        <div class="amazon-shipping-info">
          <i class="bi bi-check-circle-fill" style="color: var(--amazon-success);"></i>
          FREE delivery on orders over â‚¹499
        </div>

        <a href="{% url 'shop:checkout' %}" class="amazon-checkout-btn">
          Proceed to Buy
        </a>

        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e7e7e7;">
          <label style="display: flex; align-items: center; font-size: 14px; cursor: pointer;">
            <input type="checkbox" style="margin-right: 8px;">
            This order contains a gift
          </label>
        </div>

        <!-- Recommended Items -->
        <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #e7e7e7;">
          <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 12px;">
            Frequently bought together
          </h3>
          <div style="font-size: 14px; color: #565959;">
            Customers who bought items in your cart also bought these products.
          </div>
        </div>
      </div>
    </div>

    <!-- Recently Viewed -->
    <div style="margin-top: 40px; padding-top: 24px; border-top: 1px solid #e7e7e7;">
      <h2 style="font-size: 21px; font-weight: 400; margin-bottom: 16px;">
        Your recently viewed items
      </h2>
      <div style="font-size: 14px; color: #565959;">
        <a href="{% url 'products:product_list' %}" class="amazon-action-link">
          View or edit your browsing history
        </a>
      </div>
    </div>

  {% else %}
    <!-- Empty Cart -->
    <div class="amazon-empty-cart">
      <div class="amazon-empty-cart-icon">ðŸ›’</div>
      <h2>Your Amazon Cart is empty</h2>
      <p>Check your saved for later items below or <a href="{% url 'products:product_list' %}" class="amazon-action-link">continue shopping</a>.</p>
      
      <div style="display: flex; gap: 12px; justify-content: center; margin-top: 24px;">
        <a href="{% url 'users:login' %}" class="amazon-btn amazon-btn-primary">Sign in to your account</a>
        <a href="{% url 'users:signup' %}" class="amazon-btn amazon-btn-secondary">Sign up now</a>
      </div>

      <!-- Recommended Products for Empty Cart -->
      <div style="margin-top: 40px; text-align: left;">
        <h3 style="font-size: 18px; font-weight: 400; margin-bottom: 16px;">
          Shop today's deals
        </h3>
        <div class="amazon-product-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); max-width: 800px; margin: 0 auto;">
          <!-- This would be populated with featured products -->
          <div style="text-align: center; color: #565959; grid-column: 1 / -1;">
            <a href="{% url 'products:product_list' %}" class="amazon-action-link">
              Browse our product catalog â†’
            </a>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div>

<script>
// Auto-submit quantity changes with loading state
document.addEventListener('DOMContentLoaded', function() {
  const quantitySelects = document.querySelectorAll('.amazon-quantity-dropdown');
  
  quantitySelects.forEach(select => {
    select.addEventListener('change', function() {
      // Add loading state
      const originalHTML = this.innerHTML;
      this.innerHTML = '<option>Updating...</option>';
      this.disabled = true;
      
      // Submit form
      this.form.submit();
    });
  });
});
</script>
{% endblock %}