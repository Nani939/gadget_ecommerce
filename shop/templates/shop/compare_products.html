
{% extends "base.html" %}

{% block content %}
<div class="amazon-container">
    <!-- Compare Header -->
    <div class="compare-header">
    <h1 class="compare-header-title">üìä Product Comparison</h1>
    <p class="compare-header-desc">Compare {{ compare_count }} product{{ compare_count|pluralize }} side by side</p>
    </div>

    {% if products %}
        <!-- Comparison Table -->
        <div class="compare-table">
            <table>
                <thead>
                    <tr>
                        <th class="compare-features-th">Features</th>
                        {% for product in products %}
                            <th class="compare-product-th">
                                <button onclick="removeFromCompare({{ product.id }})" class="remove-btn">‚úï</button>
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    <!-- Product Images -->
                    <tr>
                        <td class="compare-feature-label">Product</td>
                        {% for product in products %}
                            <td>
                                <img src="{% if product.image %}{{ product.image.url }}{% else %}https://via.placeholder.com/120x120?text=No+Image{% endif %}" 
                                     alt="{{ product.name }}" class="product-image"
                                     onerror="this.src='https://via.placeholder.com/120x120?text=No+Image'">
                                <div class="compare-product-name">{{ product.name }}</div>
                            </td>
                        {% endfor %}
                    </tr>
                    
                    <!-- Price Comparison -->
                    <tr>
                        <td class="compare-feature-label">Price</td>
                        {% for product in products %}
                            <td class="price-cell {% if forloop.first %}best-value{% endif %}">
                                ‚Çπ{{ product.price|floatformat:2 }}
                            </td>
                        {% endfor %}
                    </tr>
                    
                    <!-- Rating -->
                    <tr>
                        <td class="compare-feature-label">Rating</td>
                        {% for product in products %}
                            <td>
                                <div class="amazon-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
                                <div class="compare-rating-reviews">({{ product.id|add:47 }} reviews)</div>
                            </td>
                        {% endfor %}
                    </tr>
                    
                    <!-- Stock Status -->
                    <tr>
                        <td class="compare-feature-label">Availability</td>
                        {% for product in products %}
                            <td>
                                {% if product.stock > 0 %}
                                    <span class="compare-instock">‚úÖ In Stock</span>
                                    <div class="compare-stock-qty">({{ product.stock }} available)</div>
                                {% else %}
                                    <span class="compare-outstock">‚ùå Out of Stock</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                    
                    <!-- Features -->
                    <tr class="feature-row">
                        <td class="compare-feature-label">Brand</td>
                        {% for product in products %}
                            <td>Gadget Shop</td>
                        {% endfor %}
                    </tr>
                    
                    <tr class="feature-row">
                        <td class="compare-feature-label">Model</td>
                        {% for product in products %}
                            <td>GS-{{ product.id|stringformat:"04d" }}</td>
                        {% endfor %}
                    </tr>
                    
                    <tr class="feature-row">
                        <td class="compare-feature-label">Weight</td>
                        {% for product in products %}
                            <td>{{ product.id|add:100 }}g</td>
                        {% endfor %}
                    </tr>
                    
                    <tr class="feature-row">
                        <td class="compare-feature-label">Warranty</td>
                        {% for product in products %}
                            <td>1 Year</td>
                        {% endfor %}
                    </tr>
                    
                    <!-- Actions -->
                    <tr>
                        <td class="compare-feature-label">Actions</td>
                        {% for product in products %}
                            <td>
                                {% if product.stock > 0 %}
                                    <form method="post" action="{% url 'shop:add_to_cart' product.id %}" class="compare-action-form">
                                        {% csrf_token %}
                                        <button type="submit" class="amazon-btn amazon-btn-primary compare-action-btn" title="Add {{ product.name }} to cart">
                                            üõí Add to Cart
                                        </button>
                                    </form>
                                    <form method="post" action="{% url 'shop:add_to_wishlist' product.id %}" class="compare-action-form">
                                        {% csrf_token %}
                                        <button type="submit" class="amazon-btn amazon-btn-secondary compare-action-btn" title="Add {{ product.name }} to wishlist">
                                            ‚ù§Ô∏è Add to Wishlist
                                        </button>
                                    </form>
                                {% else %}
                                    <button class="amazon-btn compare-btn-disabled" disabled title="Out of Stock">
                                        Out of Stock
                                    </button>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- AI Recommendation -->
        <div class="ai-recommendation">
            <h3 class="ai-recommendation-title">ü§ñ AI Recommendation</h3>
            <p class="ai-recommendation-desc">
                Based on your comparison, we recommend <strong>{{ products.0.name }}</strong> 
                for the best value and features combination.
            </p>
            <a href="{{ products.0.get_absolute_url }}" class="amazon-btn amazon-btn-primary ai-recommendation-link" title="View recommended product">
                View Recommended Product
            </a>
        </div>
        
    {% else %}
        <!-- Empty Compare -->
        <div class="amazon-empty-cart">
            <div class="compare-empty-icon">üìä</div>
            <h2>No products to compare</h2>
            <p>Add products to comparison by clicking the "Compare" button on product pages</p>
            <a href="{% url 'products:product_list' %}" class="amazon-btn amazon-btn-primary compare-empty-link" title="Browse products">
                üõçÔ∏è Browse Products
            </a>
        </div>
    {% endif %}
</div>

<script>
function removeFromCompare(productId) {
    if (confirm('Remove this product from comparison?')) {
        // Implementation for removing from comparison
        window.location.reload();
    }
}
</script>
{% endblock %}